\documentclass[a4paper,10pt]{article}

% ======================================================================
% CONFIGURAÇÃO DA FONTE (ARIAL / HELVETICA)
% ======================================================================
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

% Tenta usar Arial nativa (se usar XeLaTeX), senão usa Helvetica (padrão LaTeX)
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi>0
    \usepackage{fontspec}
    \setmainfont{Arial}
    \setsansfont{Arial}
\else
    \usepackage[scaled]{helvet} % Usa Helvetica (clone da Arial)
    \renewcommand{\familydefault}{\sfdefault} % Força todo o texto a ser Sans-Serif
\fi

% ======================================================================
% PACOTES E FORMATAÇÃO
% ======================================================================
\usepackage[portuguese]{babel}
\usepackage[margin=2.5cm]{geometry} % Margens
\usepackage{setspace}
\singlespacing % Espaçamento simples (conforme enunciado)
\usepackage{indentfirst}
\usepackage{xcolor}
\usepackage{titlesec}
\usepackage{soul}

% --- Pacotes Matemáticos e Gráficos ---
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{float}
\usepackage{booktabs}

% --- Bibliografia ---
\usepackage[backend=biber, style=apa, citestyle=apa]{biblatex}
\addbibresource{Recursos/referencias.bib} 

% --- Configuração de Código (Listings) ---
\usepackage{listings}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize, % Fonte monoespaçada para código
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
    language=Python
}
\lstset{style=mystyle}

% --- Hiperligações ---
\usepackage[hidelinks]{hyperref}

% --- Ajustes de Parágrafo ---
\setlength{\parskip}{6pt} % Espaço entre parágrafos
\setlength{\parindent}{1.25em}

% ======================================================================
% DEFINIÇÃO DAS CAPAS
% ======================================================================

% CAPA 1
\newcommand{\firsttitlepage}{
    \begin{titlepage}
        \centering
        
        \begin{figure}[h!]
            \centering
            % Ajustar caminho da imagem se necessário
            \includegraphics[width=6cm]{Recursos/Logos/LOGO_IPB} 
            \vspace{0.5cm}
        \end{figure}

        \large\textbf{INSTITUTO POLITÉCNICO DE BEJA} \\
        \large\textbf{Escola Superior de Tecnologia e Gestão} \\
        \large\textbf{Mestrado em Engenharia de Segurança Informática} \\
        \large\textbf{Criptografia e Criptanálise Aplicadas} \\
        
        \vspace{3cm}
        
        {\Huge \textbf{Desenvolvimento de Aplicação de\\ Cifra Simétrica}} \\
        
        \vspace{2cm}
        
        \large \textbf{Rafael Conceição Narciso - 24473} \\
        \large \textbf{Hugo Diogo - 18803} \\
        
        \vfill
        
        \begin{figure}[h!]
            \centering
            % Ajustar caminho da imagem se necessário
            \includegraphics[width=6cm]{Recursos/Logos/IPBejaESTIG} 
        \end{figure}
        
        \vspace{1cm}
        
        {\large Beja, dezembro de 2025}
    \end{titlepage}
}

% CAPA 2
\newcommand{\secondtitlepage}{
    \begin{titlepage}
        \centering
        \vspace*{1cm}
        
        \large\textbf{INSTITUTO POLITÉCNICO DE BEJA} \\
        \large\textbf{Escola Superior de Tecnologia e Gestão} \\
        \large\textbf{Mestrado em Engenharia de Segurança Informática} \\
        
        \vspace{3cm}
        
        {\Huge \textbf{Desenvolvimento de Aplicação de\\ Cifra Simétrica}} \\
        
        \vspace{2cm}
        
        \large \textbf{Rafael Conceição Narciso - 24473} \\
        \large \textbf{Hugo Diogo - 18803} \\

        \vspace{2cm}

        \large Orientador: Prof. Rui Miguel Silva \\
        
        \vfill
        
        {\large Beja, dezembro de 2025}
    \end{titlepage}
}

% ======================================================================
% CONTEÚDO DO RELATÓRIO
% ======================================================================
\begin{document}

\pagenumbering{gobble}

% --- Capas ---
\firsttitlepage
\secondtitlepage

% --- Resumo (PT) ---
\section*{\LARGE\textbf{\textit{Resumo}}}
Este relatório descreve o desenvolvimento de uma aplicação gráfica para a cifragem e decifragem de ficheiros, implementada na linguagem Python. O projeto visa consolidar conhecimentos de criptografia simétrica através da implementação manual de cifras clássicas (Vigenère e Playfair) e da integração segura de bibliotecas para cifras modernas (AES e DES). São abordadas decisões de arquitetura, modos de operação (CBC) e considerações de segurança.

\vspace{1cm}
\textbf{Palavras-chave:} Python, Criptografia Simétrica, AES, DES, Vigenère, Playfair.
\newpage

% --- Abstract (EN) ---
\section*{\LARGE\textbf{\textit{Abstract}}}
This report details the development of a graphical application for file encryption and decryption, implemented in Python. The project aims to consolidate symmetric cryptography knowledge through the manual implementation of classical ciphers (Vigenère and Playfair) and the secure integration of libraries for modern ciphers (AES and DES). Architectural decisions, modes of operation (CBC), and security considerations are discussed.

\vspace{1cm}
\textbf{Keywords:} Python, Symmetric Cryptography, AES, DES, Vigenère, Playfair.

% --- Índices ---
\newpage
\renewcommand{\contentsname}{Índice}
\renewcommand{\listfigurename}{Índice de Figuras}

% Espaçamento simples nas listas
\singlespacing 
\tableofcontents
\listoffigures
\doublespacing % Volta a espaçamento normal se necessário, ou mantém single

\newpage
\pagenumbering{arabic}
\setcounter{page}{1}
\singlespacing % Garante espaçamento simples no texto (requisito do enunciado)

% ======================================================================
% 1. INTRODUÇÃO
% ======================================================================
\section{Introdução}\label{intro}
A segurança da informação depende, em grande medida, da robustez dos algoritmos criptográficos utilizados para proteger a confidencialidade dos dados. Este projeto, desenvolvido no âmbito da unidade curricular de Criptografia e Criptanálise Aplicadas, consiste na criação de uma ferramenta em Python capaz de cifrar e decifrar ficheiros utilizando quatro algoritmos distintos: dois clássicos (Vigenère e Playfair) e dois modernos (DES e AES).

A aplicação fornece uma Interface Gráfica (GUI) para facilitar a interação do utilizador, abstraindo a complexidade das operações matemáticas e binárias subjacentes.

% ======================================================================
% 2. ENQUADRAMENTO TEÓRICO
% ======================================================================
\section{Enquadramento Teórico}\label{theory}

\subsection{Cifras Clássicas}
As cifras clássicas implementadas operam ao nível do caráter e pertencem à era pré-computacional.
\begin{itemize}
    \item \textbf{Vigenère:} Uma cifra polialfabética que utiliza uma chave e uma tabela (\textit{Tabula Recta}) para substituir caracteres, dificultando a análise de frequências simples.
    \item \textbf{Playfair:} Uma cifra de substituição poligráfica que opera sobre digramas (pares de letras) utilizando uma matriz $5 \times 5$.
\end{itemize}

\subsection{Cifras Modernas}
As cifras modernas operam sobre blocos de bits e são desenhadas para resistir a ataques computacionais.
\begin{itemize}
    \item \textbf{DES (Data Encryption Standard):} Algoritmo de bloco de 64 bits baseado numa Rede de Feistel. Utiliza uma chave de 56 bits.
    \item \textbf{AES (Advanced Encryption Standard):} Sucessor do DES, operando com blocos de 128 bits e chaves de 128, 192 ou 256 bits, baseado numa rede de substituição-permutação.
\end{itemize}

% ======================================================================
% 3. DESENVOLVIMENTO DA APLICAÇÃO
% ======================================================================
\section{Desenvolvimento da Aplicação}\label{dev}
A aplicação foi desenvolvida em \textbf{Python} devido à sua versatilidade na manipulação de \textit{byte streams}. A interface gráfica foi construída com a biblioteca \textbf{Tkinter}, seguindo uma arquitetura orientada a eventos.

\subsection{Interface Gráfica (GUI)}
A GUI permite ao utilizador selecionar o algoritmo, carregar os ficheiros de chave/tabela e indicar os ficheiros de entrada e saída.

\begin{figure}[H]
    \centering
    % COLOCA AQUI O CAMINHO DA TUA GUI
    %\includegraphics[width=0.8\textwidth]{Recursos/GUI.png}
    \caption{Interface principal da aplicação desenvolvida.}
    \label{fig:gui_main}
\end{figure}

\subsection{Implementação: AES e DES}
Para as cifras modernas, utilizou-se a biblioteca \textbf{PyCryptodome}. 
Ao contrário de implementações triviais que utilizam o modo ECB (Electronic Codebook), optou-se pelo modo \textbf{CBC (Cipher Block Chaining)} para garantir a segurança semântica.

\textbf{Detalhes de Implementação:}
\begin{itemize}
    \item \textbf{Padding:} Foi aplicado \textit{padding} PKCS7 para ajustar o tamanho dos dados ao tamanho do bloco (8 bytes para DES, 16 para AES).
    \item \textbf{Gestão de IV:} O Vetor de Inicialização (IV) é gerado aleatoriamente e concatenado no início do ficheiro cifrado.
\end{itemize}

\begin{lstlisting}[caption={Cifragem AES com concatenação de IV}, label={lst:aes_code}]
def encrypt_file(self, data):
    cipher = AES.new(self.key, AES.MODE_CBC)
    ct_bytes = cipher.encrypt(pad(data, AES.block_size))
    # Retorna o IV (16 bytes) + Texto Cifrado
    return cipher.iv + ct_bytes
\end{lstlisting}

\subsection{Implementação: Vigenère}
A cifra de Vigenère foi implementada de raiz. A função \texttt{\_extend\_key} garante que a chave cobre todo o texto. A operação matemática é realizada módulo 26.

\begin{lstlisting}[caption={Lógica aritmética do Vigenère}, label={lst:vig_code}]
row = ord(key[i]) - ord('A')
col = ord(char) - ord('A')
encrypted_char = self.table[row][col]
\end{lstlisting}

\subsection{Implementação: Playfair}
A cifra Playfair envolveu a criação dinâmica da matriz $5 \times 5$, fundindo 'I' e 'J'. Foi implementado um pré-processamento para inserir o caráter 'X' entre letras repetidas num digrama.

% ======================================================================
% 4. ANÁLISE DE SEGURANÇA
% ======================================================================
\section{Análise de Segurança e Decisões de Projeto}
Apesar da funcionalidade correta, identificam-se os seguintes aspetos críticos de segurança:

\begin{enumerate}
    \item \textbf{Gestão de Chaves:} As chaves são lidas de ficheiros de texto simples. Em produção, dever-se-ia utilizar um KMS (Key Management System).
    \item \textbf{Integridade:} O modo CBC garante confidencialidade, mas não integridade. A aplicação é vulnerável a ataques de modificação de bits ("bit-flipping"), pois não implementa HMAC para autenticação da mensagem.
    \item \textbf{Memória:} Python não permite limpeza segura de memória, deixando chaves expostas em RAM durante a execução.
\end{enumerate}

% ======================================================================
% 5. TESTES E RESULTADOS
% ======================================================================
\section{Testes e Resultados}
Foram realizados testes de cifra e decifra garantindo que o ficheiro decifrado é binariamente idêntico ao original.

\begin{figure}[H]
    \centering
    % Substituir pelos teus caminhos
    %\includegraphics[width=0.8\textwidth]{Recursos/aes_test.png}
    \caption{Exemplo de operação com AES.}
    \label{fig:tests}
\end{figure}

% ======================================================================
% 6. CONCLUSÃO
% ======================================================================
\section{Conclusão}\label{con}
O desenvolvimento deste projeto permitiu consolidar a distinção prática entre cifras de fluxo de texto (Clássicas) e cifras de bloco binário (Modernas). A implementação do modo CBC e a gestão manual de tabelas no Playfair foram os principais desafios superados, resultando numa ferramenta funcional e didática.

% --- Bibliografia ---
\newpage
\printbibliography

\end{document}